<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://lib.baomitu.com/aplayer/latest/APlayer.min.css"><script src="https://lib.baomitu.com/aplayer/latest/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://code.bdstatic.com/npm/meting@1.2.0/dist/Meting.min.js"></script>!function(){document.addEventListener("DOMContentLoaded",()=>{ScrollReveal().destroy();const t=new Vue({data:function(){return{list:[],rankDay:"",rankType:"day",page:0,noMore:!1,loading:!0,moreLoading:!1,showRBtn:!1}},created:function(){this.init()},methods:{init:function(){!async function(){var t=r(0),a="__pixivDailyRank",e=localStorage.getItem(a);try{var i=JSON.parse(e);if(i&&i.today==t)return i;localStorage.removeItem(a)}catch(t){console.log(t)}const n=await Promise.all([function(t){return s("https://mk-pixiv.kanata.ml/?r=api%2Fpixiv-json&_t="+t)}(t),function(t){return s("https://mk-pixiv.kanata.ml/?r=api%2Fsource-json&_t"+t)}(t)]);if(n.some(t=>!t.data||!t.data.length))throw new Error("Empty.");const o=n[0],l={today:t,date:o.date,images:[]};return o.data.forEach((t,a)=>{const e=o.url[a],i=n[1].image[a];l.images.push([{thumb:t.url.includes("pic.rmb.bdstatic.com")?t.url:i.replace("i.pximg.net","ipximg.kanata.ml"),large:(i,(i||"").replace(/i\.pximg\.net\/c\/\d+x\d+/i,"pximg.cocomi.cf")),original:"https://pid.kanata.ml/"+e.split("/").pop(),link:"https://www.pixiv.net/"+e,title:t.title,author:t.user_name}])}),localStorage.setItem(a,JSON.stringify(l)),l}().then(t=>{this.rankDay=t.date,this.list=t.images,this.$nextTick(()=>{Fancybox.Plugins.Toolbar.defaults.items.toPixivPage={type:"button",class:"fancybox__button--toPixivPage",label:"Pixiv Page",html:'<svg viewBox="0 0 1024 1024"><path d="M938.080549 499.785143L791.94112 645.851429a51.712 51.712 0 1 1-73.142857-73.142858l146.139428-146.139428a189.44 189.44 0 0 0-267.849142-267.849143L450.94912 304.932571a51.638857 51.638857 0 0 1-72.996571-72.996571l146.066285-146.139429a292.790857 292.790857 0 0 1 413.988572 413.988572zM85.746834 938.203429a292.717714 292.717714 0 0 1 0-413.988572l146.212572-146.212571a51.638857 51.638857 0 0 1 72.996571 73.069714l-146.139428 146.285714a189.44 189.44 0 1 0 267.849142 267.849143L572.731977 718.994286a51.638857 51.638857 0 1 1 73.069714 72.996571l-146.139428 146.285714a292.717714 292.717714 0 0 1-413.988572 0v-0.073142z" fill="#0096fa" p-id="8549"></path><path d="M402.382263 694.637714l292.205714-292.278857a51.638857 51.638857 0 1 0-73.069714-72.996571L329.312549 621.494857a51.638857 51.638857 0 0 0 72.996571 73.142857h0.073143z" fill="#0096fa"></path></svg>',click:function(t){t.preventDefault();t=this.fancybox.Carousel.slides[this.fancybox.Carousel.page];window.open(t.pixivLink,"_blank","noreferrer")}},Fancybox.Plugins.Toolbar.defaults.items.toPixivMoePage={type:"button",class:"fancybox__button--toPixivPage",label:"Vilipix Page",html:'<svg viewBox="0 0 1024 1024"><path d="M593.94368 715.648a10.688 10.688 0 0 0-14.976 0L424.21568 870.4c-71.68 71.68-192.576 79.232-271.68 0-79.232-79.232-71.616-200 0-271.616l154.752-154.752a10.688 10.688 0 0 0 0-15.04l-52.992-52.992a10.688 10.688 0 0 0-15.04 0L84.50368 530.688a287.872 287.872 0 0 0 0 407.488 288 288 0 0 0 407.488 0l154.752-154.752a10.688 10.688 0 0 0 0-15.04l-52.736-52.736z m344.384-631.168a288.256 288.256 0 0 1 0 407.616l-154.752 154.752a10.688 10.688 0 0 1-15.04 0l-52.992-52.992a10.688 10.688 0 0 1 0-15.104l154.752-154.688c71.68-71.68 79.232-192.448 0-271.68-79.104-79.232-200-71.68-271.68 0L443.92768 307.2a10.688 10.688 0 0 1-15.04 0l-52.864-52.864a10.688 10.688 0 0 1 0-15.04l154.88-154.752a287.872 287.872 0 0 1 407.424 0z m-296.32 240.896l52.672 52.736a10.688 10.688 0 0 1 0 15.04l-301.504 301.44a10.688 10.688 0 0 1-15.04 0l-52.736-52.672a10.688 10.688 0 0 1 0-15.04l301.632-301.504a10.688 10.688 0 0 1 15.04 0z" fill="#fff"></path></svg>',click:function(t){t.preventDefault();const a=this.fancybox.Carousel.slides[this.fancybox.Carousel.page];t="https://www.vilipix.com/illust/"+a.pixivLink.split("/").pop();window.open(t,"_blank","noreferrer")}},Fancybox.bind("[data-fancybox]",{preload:0,infinite:!1,Toolbar:{display:["counter","toPixivPage","toPixivMoePage","zoom","slideshow","fullscreen","download","thumbs","close"]},on:{initCarousel:t=>{var a=t.Carousel.slides[t.Carousel.page];t.$container.style.setProperty("--bg-image",`url("${a.thumb}")`)},"Carousel.change":(t,a,e,i)=>{e=a.slides[e];t.$container.style.setProperty("--bg-image",`url("${e.thumb}")`)}}}),imagesLoaded("#macy-container",t=>{t.images.forEach(t=>{t.img.classList.add("show")}),this.loading=!1})})}).catch(t=>{this.loading=!1,this.showPixivic=!0})},fetchModeRank:function(t){this.rankType=t,this.page=1,this.noMore=!1,this.rankDay=r(-1),this.getMoreData()},onDateChange:function(){this.page=1,this.noMore=!1,this.getMoreData()},getMoreData:function(){this.page<1||this.noMore||(this.moreLoading=!0,1==this.page&&(window.scroll(0,0),this.list=[]),async function(t,a,e){const i=(new Date).toLocaleString("ja-JP-u-ca-japanese").replace(/[\s/:]+/g,"").slice(0,-4),n=await s(`https://pixiv-api.kanata.ml/v2?type=rank&mode=${a}&page=${t}&date=${e}&_t=${i}&_vercel_no_cache=1`);return n.illusts.map(a=>{const e="https://www.pixiv.net/artworks/"+a.id;var t=a.tags.map(t=>{let a=`<a href="https://www.pixiv.net/tags/${t.name}/artworks" target="_blank" rel="nofollow noreferrer" style="color:#0096fa">${t.name}</a>`;return t.translated_name&&(a+=`<small style="margin-left:5px;color:#adadad">[${t.translated_name}]</small>`),`<span style="margin-right:10px">${a}</span>`}).join("");const i=`<div style="text-align:center">PID: ${a.id} 标题: ${a.title} 画师: ${a.user.name}<br/>标签: ${t}<div>`;if(a.meta_pages.length)return a.meta_pages.map(t=>({thumb:l(t.image_urls.medium),large:t.image_urls.large.replace(/i\.pximg\.net\/c\/\d+x\d+.*\/img-/i,"pximg.cocomi.cf/img-"),original:l(t.image_urls.original),link:e,caption:i,title:a.title,author:a.user.name}));var n=a.image_urls.medium;const o=a.image_urls.large;t=a.meta_single_page.original_image_url;return[{thumb:l(n),large:o.replace(/i\.pximg\.net\/c\/\d+x\d+.*\/img-/i,"pximg.cocomi.cf/img-"),original:l(t),link:e,caption:i,title:a.title,author:a.user.name}]})}(this.page,this.rankType,this.rankDay).then(t=>0===t.length?(this.noMore=!0,void(this.moreLoading=!1)):(this.list=this.list.concat(t),this.page++,void this.$nextTick(()=>{imagesLoaded("#macy-container",t=>{t.images.forEach(t=>{t.img.classList.add("show")}),this.moreLoading=!1})}))).catch(()=>{this.moreLoading=!1}))}}});t.$mount("#pixiv_rank")});async function s(t){const a=await fetch(t);if(!a.ok)throw new Error("Resp not ok.");return a.json()}function l(t){return t.replace("i.pximg.net","pximg.cocomi.cf")}function r(t){const a=new Date;var e=a.getTime();a.setTime(parseInt(e+864e5*t,10));t=a.getFullYear();let i=(a.getMonth()+1).toString();i.length<=1&&(i="0"+i);let n=a.getDate().toString();return n.length<=1&&(n="0"+n),t+"-"+i+"-"+n}}();